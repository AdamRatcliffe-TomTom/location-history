{"version":3,"file":"index.js","sources":["../http.js","../services/objects.js","../services/position_history.js"],"sourcesContent":["import axios from \"axios\";\nimport rateLimit from \"axios-rate-limit\";\n\nconst QPS_LIMIT = process.env.QPS_LIMIT || 5;\nconst QPS_INTERVAL = process.env.QPS_INTERVAL || 1000;\n\nconst http = rateLimit(axios.create(), {\n  maxRequests: QPS_LIMIT,\n  perMilliseconds: QPS_INTERVAL\n});\n\nexport default http;\n","import http from \"../http\";\n\nconst LOCATION_HISTORY_API_BASE_URL =\n  process.env.LOCATION_HISTORY_API_BASE_URL ||\n  \"https://api.tomtom.com/locationHistory/1\";\n\nconst addObject = async ({ apiKey, adminKey, object }) => {\n  const url = `${LOCATION_HISTORY_API_BASE_URL}/objects?key=${apiKey}&adminKey=${adminKey}`;\n  const { data } = await http.post(url, object);\n  return data;\n};\n\nconst editObject = async ({ apiKey, adminKey, id, object }) => {\n  const url = `${LOCATION_HISTORY_API_BASE_URL}/objects/${id}?key=${apiKey}&adminKey=${adminKey}`;\n  const { data } = await http.put(url, object);\n  return data;\n};\n\nconst getObjects = async ({ apiKey }) => {\n  const url = `${LOCATION_HISTORY_API_BASE_URL}/objects?key=${apiKey}`;\n  const { data } = await http.get(url);\n  const objectDetailRequests = data.objects.map(({ id }) =>\n    getObjectDetail({ apiKey, id })\n  );\n  const objects = await Promise.all(objectDetailRequests);\n  return objects;\n};\n\nconst getObjectDetail = async ({ apiKey, id }) => {\n  const url = `${LOCATION_HISTORY_API_BASE_URL}/objects/${id}?key=${apiKey}`;\n  const { data } = await http.get(url);\n  return data;\n};\n\nconst deleteObject = async ({ apiKey, id }) => {\n  const url = `${LOCATION_HISTORY_API_BASE_URL}/objects/${id}?key=${apiKey}`;\n  const { data } = await http.delete(url);\n  return data;\n};\n\nexport { addObject, editObject, getObjects, getObjectDetail, deleteObject };\n","import http from \"../http\";\n\nconst LOCATION_HISTORY_API_BASE_URL =\n  process.env.LOCATION_HISTORY_API_BASE_URL ||\n  \"https://api.tomtom.com/locationHistory/1\";\n\nconst sendPosition = async ({\n  apiKey,\n  adminKey,\n  objectId,\n  longitude,\n  latitude,\n  altitude,\n  timestamp\n}) => {\n  const url = `${LOCATION_HISTORY_API_BASE_URL}/history/positions?key=${apiKey}&adminKey=${adminKey}`;\n  const coordinates = [\n    longitude,\n    latitude,\n    ...(Boolean(altitude) ? [altitude] : [])\n  ];\n  const position = {\n    type: \"Feature\",\n    geometry: {\n      type: \"Point\",\n      coordinates\n    },\n    object: objectId,\n    ...(timestamp && { timestamp })\n  };\n  const { data } = await http.post(url, position);\n  return data;\n};\n\nconst lastPosition = async ({ apiKey, objectId }) => {\n  const url = `${LOCATION_HISTORY_API_BASE_URL}/history/position/${objectId}?key=${apiKey}`;\n  const { data } = await http.get(url);\n  return data;\n};\n\nconst positionHistory = async ({\n  apiKey,\n  objectId,\n  from,\n  to,\n  maxResults,\n  pageNumber\n}) => {\n  let url = `${LOCATION_HISTORY_API_BASE_URL}/history/positions/${objectId}?key=${apiKey}&from=${from}`;\n  if (to) url += `&to=${to}`;\n  if (maxResults) url += `&maxResults=${maxResults}`;\n  if (pageNumber) url += `&pageNumber=${pageNumber}`;\n\n  const { data } = await http.get(url);\n  return data;\n};\n\nconst clearPositionHistory = async ({ apiKey, adminKey }) => {\n  const url = `${LOCATION_HISTORY_API_BASE_URL}/history/position?key=${apiKey}&adminKey=${adminKey}`;\n  const { data } = await http.delete(url);\n  return data;\n};\n\nexport { sendPosition, lastPosition, positionHistory, clearPositionHistory };\n"],"names":["QPS_LIMIT","process","env","QPS_INTERVAL","http","rateLimit","axios","create","maxRequests","perMilliseconds","LOCATION_HISTORY_API_BASE_URL","getObjectDetail","_ref8","apiKey","id","Promise","resolve","get","data","e","reject","addObject","adminKey","object","post","_ref7","_ref10","then","_ref11","_ref3","put","_ref4","getObjects","_ref6","objectDetailRequests","objects","map","all","objectId","_ref5","from","to","maxResults","pageNumber","url","_ref","longitude","latitude","altitude","timestamp","type","geometry","coordinates","Boolean","position"],"mappings":"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"}